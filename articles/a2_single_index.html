<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coastwide indices • indexwc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Coastwide indices">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">indexwc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a1_configuration.html">Configuration File</a>
    </li>
    <li>
      <a href="../articles/a2_single_index.html">Coastwide indices</a>
    </li>
    <li>
      <a href="../articles/a3_multiple_area_indices.html">Index example with multiple areas</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pfmc-assessments/indexwc/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Coastwide indices</h1>
            
            <h4 data-toc-skip class="date">2026-01-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/pfmc-assessments/indexwc/blob/main/vignettes/a2_single_index.Rmd" class="external-link"><code>vignettes/a2_single_index.Rmd</code></a></small>
      <div class="hidden name"><code>a2_single_index.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette highlights the ability to generate coastwide indices
for stocks using the <code>indexwc</code> package.</p>
</div>
<div class="section level2">
<h2 id="yellowtail-rockfish-example">Yellowtail rockfish example<a class="anchor" aria-label="anchor" href="#yellowtail-rockfish-example"></a>
</h2>
<p>As a case study, we’ll focus on yellowtail rockfish. The package
includes <code>yellowtail</code>, which is the yellowtail data from the
WCGBTS 2003 – 2023.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pfmc-assessments/indexwc" class="external-link">indexwc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sdmTMB.github.io/sdmTMB/" class="external-link">sdmTMB</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CRAN <span class="op">=</span> <span class="st">"https://cloud.r-project.org"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>First we’ll load in the configuration file. This step is not needed –
and the formulas, etc. may be specified from scratch, but this file is
used to keep models reproducible across assessment cycles. The
configuration file brings in specific settings by survey and species
that are used to subset the data and define the parameterization of the
index estimation. This file is included as both an <code>rda</code> file
that is loaded with the package but is also available for users who
download the source code in the <code>data-raw</code> folder (download
the package to see this).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load from the rda file</span></span>
<span><span class="va">configuration_ytk</span> <span class="op">&lt;-</span> <span class="va">configuration</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"yellowtail rockfish"</span><span class="op">)</span></span></code></pre></div>
<p>The configuration file contains settings you may wish to change,
including attributes of filters (years, latitudes, depths), and model
components (anisotropy, knots, spatiotemporal effects, etc).</p>
<p>The configuration includes multiple entries for a single species for
separate surveys and error distributions (e.g., delta-lognormal,
delta-gamma, etc.).</p>
<p>In this example, we are going to only run a single-index for the
Northwest Fisheries Science Center (NWFSC) West Coast Groundfish Bottom
Trawl (WCGBT) survey (i.e., also referred to as the “NWFSC.Combo” survey
in the data NWFSC data warehouse, or R package nwfscSurvey).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">configuration_ytk_wcgbt</span> <span class="op">&lt;-</span> <span class="va">configuration_ytk</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">source</span> <span class="op">==</span> <span class="st">"NWFSC.Combo"</span> <span class="op">&amp;</span> <span class="va">family</span> <span class="op">==</span> <span class="st">"sdmTMB::delta_gamma()"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="statistical-model">Statistical model<a class="anchor" aria-label="anchor" href="#statistical-model"></a>
</h3>
<p>For most indices developed on the west coast of the USA, the main
formula is usually something similar to the following, where
<code>fyear</code> represents a fixed year effect, and
<code>pass_scaled</code> is factor describing whether the haul is part
of pass 1 (early season) or pass 2 (late season).</p>
<p>There are two unique index formula’s available for yellowtail
rockfish:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">configuration_ytk_wcgbt</span><span class="op">[</span>, <span class="st">"formula"</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "catch_weight ~ 0 + fyear*split_mendocino + pass_scaled"</span></span>
<span><span class="co">#&gt; [2] "catch_weight ~ 0 + fyear + pass_scaled"</span></span></code></pre></div>
<p>we are going to use the default configuration. Please see the
vignette on multiple area indices for an example run with the other
formulation available for yellowtail rockfish.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">configuration_to_run</span> <span class="op">&lt;-</span> <span class="va">configuration_ytk_wcgbt</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">formula</span> <span class="op">==</span> <span class="st">"catch_weight ~ 0 + fyear + pass_scaled"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="preparing-the-data">Preparing the data<a class="anchor" aria-label="anchor" href="#preparing-the-data"></a>
</h3>
<p>This block pulls trawl survey from the NWFSC data warehouse and
applies filters (based on latitude, depth, and year) to each
observation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"yellowtail"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">yellowtail</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">depth</span> <span class="op">&lt;=</span> <span class="va">configuration_to_run</span><span class="op">$</span><span class="va">min_depth</span>, </span>
<span>        <span class="va">depth</span> <span class="op">&gt;=</span> <span class="va">configuration_to_run</span><span class="op">$</span><span class="va">max_depth</span>,</span>
<span>        <span class="va">latitude</span> <span class="op">&gt;=</span> <span class="va">configuration_to_run</span><span class="op">$</span><span class="va">min_latitude</span>, </span>
<span>        <span class="va">latitude</span> <span class="op">&lt;=</span> <span class="va">configuration_to_run</span><span class="op">$</span><span class="va">max_latitude</span>,</span>
<span>        <span class="va">year</span> <span class="op">&gt;=</span> <span class="va">configuration_to_run</span><span class="op">$</span><span class="va">min_year</span>, </span>
<span>        <span class="va">year</span> <span class="op">&lt;=</span> <span class="va">configuration_to_run</span><span class="op">$</span><span class="va">max_year</span></span>
<span>      <span class="op">)</span></span></code></pre></div>
<p>The filtered data has several thousand less rows than the raw
data.</p>
</div>
<div class="section level3">
<h3 id="fitting-the-model-with-indexwc-and-sdmtmb">Fitting the model with indexwc and sdmTMB<a class="anchor" aria-label="anchor" href="#fitting-the-model-with-indexwc-and-sdmtmb"></a>
</h3>
<p>Now we can use the <code>indexwc</code> package to fit the model. The
<code>indexwc</code> package acts as a wrapper for <code>sdmTMB</code>
here, combining the estimation process (<code><a href="https://sdmTMB.github.io/sdmTMB/reference/sdmTMB.html" class="external-link">sdmTMB()</a></code>) with the
index generation (<code><a href="https://sdmTMB.github.io/sdmTMB/reference/get_index.html" class="external-link">get_index()</a></code>).</p>
<p>A key point to highlight is that in this code, we use
<code><a href="https://sdmTMB.github.io/sdmTMB/reference/sdmTMBcontrol.html" class="external-link">sdmTMBcontrol()</a></code> to pass in a list that contains the
variables above we use to map off and initialize the parameters. For
datasets without missing values, you may not want to include this
<code><a href="https://sdmTMB.github.io/sdmTMB/reference/sdmTMBcontrol.html" class="external-link">sdmTMBcontrol()</a></code> line, but it may be useful to adjust the
<code>newton_loops</code>, etc.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the character string needs to be parsed before used as input</span></span>
<span><span class="va">family_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/parse_expr.html" class="external-link">parse_expr</a></span><span class="op">(</span><span class="va">configuration_to_run</span><span class="op">$</span><span class="va">family</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sdmtmb.html">run_sdmtmb</a></span><span class="op">(</span>dir_main <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                       <span class="va">data</span>,</span>
<span>                       family <span class="op">=</span> <span class="va">family_obj</span>,</span>
<span>                       formula <span class="op">=</span> <span class="va">configuration_to_run</span><span class="op">$</span><span class="va">formula</span>,</span>
<span>                       n_knots <span class="op">=</span> <span class="va">configuration_to_run</span><span class="op">$</span><span class="va">knots</span>,</span>
<span>                       share_range <span class="op">=</span> <span class="va">configuration_to_run</span><span class="op">$</span><span class="va">share_range</span>,</span>
<span>                  sdmtmb_control <span class="op">=</span> <span class="fu">sdmTMB</span><span class="fu">::</span><span class="fu"><a href="https://sdmTMB.github.io/sdmTMB/reference/sdmTMBcontrol.html" class="external-link">sdmTMBcontrol</a></span><span class="op">(</span>newton_loops <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In the above example, <code>dir</code> is specified to be NULL, so
the fitted object will be returned. But if this is a directory name, it
will be created and used to save data and the model fit.</p>
</div>
<div class="section level3">
<h3 id="examining-diagnostics">Examining diagnostics<a class="anchor" aria-label="anchor" href="#examining-diagnostics"></a>
</h3>
<p>All diagnostics and plots are generated by the
<code><a href="../reference/diagnose.html">diagnose()</a></code> function. This function takes a fitted object
and prediction grid as input, and optionally a directory name
(<code>dir</code>) for saving results to.</p>
<p>For simplicity and speed, we can change simplify our previous
yellowtail model to be spatial only.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">family_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/parse_expr.html" class="external-link">parse_expr</a></span><span class="op">(</span><span class="va">configuration_to_run</span><span class="op">$</span><span class="va">family</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sdmtmb.html">run_sdmtmb</a></span><span class="op">(</span></span>
<span>  dir_main <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  family <span class="op">=</span> <span class="va">family_obj</span>,</span>
<span>  formula <span class="op">=</span> <span class="va">configuration_to_run</span><span class="op">$</span><span class="va">formula</span>,</span>
<span>  n_knots <span class="op">=</span> <span class="va">configuration_to_run</span><span class="op">$</span><span class="va">knots</span>,</span>
<span>  share_range <span class="op">=</span> <span class="va">configuration_to_run</span><span class="op">$</span><span class="va">share_range</span>,</span>
<span>  spatial <span class="op">=</span> <span class="st">"off"</span>,</span>
<span>  spatiotemporal <span class="op">=</span> <span class="st">"off"</span>,</span>
<span>  sdmtmb_control <span class="op">=</span> <span class="fu">sdmTMB</span><span class="fu">::</span><span class="fu"><a href="https://sdmTMB.github.io/sdmTMB/reference/sdmTMBcontrol.html" class="external-link">sdmTMBcontrol</a></span><span class="op">(</span>newton_loops <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Next, we can run the diagnostics with the California Current
prediction grid</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_grid</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="fu">::</span><span class="fu"><a href="https://sdmTMB.github.io/sdmTMB/reference/replicate_df.html" class="external-link">replicate_df</a></span><span class="op">(</span><span class="va">california_current_grid</span>, </span>
<span>                                  time_name <span class="op">=</span> <span class="st">"year"</span>, </span>
<span>                                  time_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pred_grid</span><span class="op">$</span><span class="va">fyear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">pred_grid</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span></span>
<span><span class="va">diagnostics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diagnose.html">diagnose</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                        fit <span class="op">=</span> <span class="va">fit_simple</span>,</span>
<span>                        prediction_grid <span class="op">=</span> <span class="va">pred_grid</span><span class="op">)</span></span></code></pre></div>
<p>If <code>dir</code> is specified, output and diagnostics for all
models and predictions are stored in a folder that <code>indexwc</code>
creates. If no directory is specified
<code>diagnose(dir = NULL,...)</code> then named list is returned.
Stepping through what elements are output:</p>
<p>The <code><a href="https://sdmTMB.github.io/sdmTMB/reference/sanity.html" class="external-link">sdmTMB::sanity()</a></code> checks can be accessed with</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagnostics</span><span class="op">$</span><span class="va">sanity</span></span>
<span><span class="co">#&gt;                           names logical text</span></span>
<span><span class="co">#&gt; hessian_ok           hessian_ok    TRUE TRUE</span></span>
<span><span class="co">#&gt; eigen_values_ok eigen_values_ok    TRUE TRUE</span></span>
<span><span class="co">#&gt; nlminb_ok             nlminb_ok    TRUE TRUE</span></span>
<span><span class="co">#&gt; range_ok               range_ok    TRUE TRUE</span></span>
<span><span class="co">#&gt; gradients_ok       gradients_ok    TRUE TRUE</span></span>
<span><span class="co">#&gt; se_magnitude_ok se_magnitude_ok    TRUE TRUE</span></span>
<span><span class="co">#&gt; se_na_ok               se_na_ok    TRUE TRUE</span></span>
<span><span class="co">#&gt; sigmas_ok             sigmas_ok    TRUE TRUE</span></span>
<span><span class="co">#&gt; all_ok                   all_ok    TRUE TRUE</span></span></code></pre></div>
<p>The model is returned with</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagnostics</span><span class="op">$</span><span class="va">model</span></span>
<span><span class="co">#&gt; [1] "delta_gamma(link1 = 'logit', link2 = 'log')"</span></span></code></pre></div>
<p>The formula is returned with</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagnostics</span><span class="op">$</span><span class="va">formula</span></span>
<span><span class="co">#&gt; catch_weight ~ 0 + fyear + pass_scaled</span></span>
<span><span class="co">#&gt; &lt;environment: 0x5637269c0fd0&gt;</span></span></code></pre></div>
<p>The log-likelihood and AIC are returned with</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagnostics</span><span class="op">$</span><span class="va">loglike</span></span>
<span><span class="co">#&gt; 'log Lik.' -123.9427 (df=43)</span></span>
<span><span class="va">diagnostics</span><span class="op">$</span><span class="va">aic</span></span>
<span><span class="co">#&gt; [1] 333.8853</span></span></code></pre></div>
<p>A tibble with fixed and random effects (with standard error and
confidence intervals) is returned with</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagnostics</span><span class="op">$</span><span class="va">effects</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 43 × 6</span></span></span>
<span><span class="co">#&gt;    term      estimate std.error conf.low conf.high model</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> fyear2003    -<span style="color: #BB0000;">1.69</span>     0.193    -<span style="color: #BB0000;">2.07</span>     -<span style="color: #BB0000;">1.32</span>     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> fyear2004    -<span style="color: #BB0000;">1.96</span>     0.228    -<span style="color: #BB0000;">2.41</span>     -<span style="color: #BB0000;">1.52</span>     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> fyear2005    -<span style="color: #BB0000;">1.56</span>     0.171    -<span style="color: #BB0000;">1.89</span>     -<span style="color: #BB0000;">1.22</span>     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> fyear2006    -<span style="color: #BB0000;">1.86</span>     0.197    -<span style="color: #BB0000;">2.25</span>     -<span style="color: #BB0000;">1.48</span>     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> fyear2007    -<span style="color: #BB0000;">1.54</span>     0.165    -<span style="color: #BB0000;">1.86</span>     -<span style="color: #BB0000;">1.21</span>     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> fyear2008    -<span style="color: #BB0000;">1.82</span>     0.194    -<span style="color: #BB0000;">2.20</span>     -<span style="color: #BB0000;">1.44</span>     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> fyear2009    -<span style="color: #BB0000;">1.76</span>     0.184    -<span style="color: #BB0000;">2.12</span>     -<span style="color: #BB0000;">1.40</span>     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> fyear2010    -<span style="color: #BB0000;">1.53</span>     0.167    -<span style="color: #BB0000;">1.85</span>     -<span style="color: #BB0000;">1.20</span>     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> fyear2011    -<span style="color: #BB0000;">1.47</span>     0.164    -<span style="color: #BB0000;">1.79</span>     -<span style="color: #BB0000;">1.15</span>     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> fyear2012    -<span style="color: #BB0000;">1.58</span>     0.175    -<span style="color: #BB0000;">1.92</span>     -<span style="color: #BB0000;">1.24</span>     1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 33 more rows</span></span></span></code></pre></div>
<p>The SPDE mesh plot can be accessed with</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagnostics</span><span class="op">$</span><span class="va">mesh_plot</span></span></code></pre></div>
<p><img src="a2_single_index_files/figure-html/diagmesh-1.png" class="r-plt" alt="" width="700"></p>
<p>The QQ plot (appearing as a single plot when a non-delta family is
used, or 2 plots when a delta family is used) is accessed with</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagnostics</span><span class="op">$</span><span class="va">qq_plot</span></span></code></pre></div>
<p><img src="a2_single_index_files/figure-html/diagqq-1.png" class="r-plt" alt="" width="700"></p>
<p>When anisotropy is not included (as in our model) no plot is
available, but when included it can be seen by accessing</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagnostics</span><span class="op">$</span><span class="va">anisotropy_plot</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>A plot of the fixed effects parameters can be accessed with</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagnostics</span><span class="op">$</span><span class="va">fixed_effects_plot</span></span></code></pre></div>
<p><img src="a2_single_index_files/figure-html/diagfixed-1.png" class="r-plt" alt="" width="700"></p>
<p>Density plots are made separately for each year, and stored 2 per
page in a list of lists. They can be accessed with</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagnostics</span><span class="op">$</span><span class="va">density_plots</span><span class="op">[[</span><span class="fl">10</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="a2_single_index_files/figure-html/diagdensity-1.png" class="r-plt" alt="" width="700"></p>
<p>Maps are also made of the residuals. Accessing these can be a little
funny, but is done with pagination</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="va">diagnostics</span><span class="op">$</span><span class="va">residual_maps_by_year</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">ggforce</span><span class="fu">::</span><span class="fu"><a href="https://ggforce.data-imaginist.com/reference/n_pages.html" class="external-link">n_pages</a></span><span class="op">(</span><span class="va">plot1</span><span class="op">)</span> <span class="co"># check number of pages</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co"># View page 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot1</span> <span class="op">+</span> <span class="fu">ggforce</span><span class="fu">::</span><span class="fu"><a href="https://ggforce.data-imaginist.com/reference/facet_wrap_paginate.html" class="external-link">facet_wrap_paginate</a></span><span class="op">(</span><span class="st">"year"</span>, nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">2</span>, page <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="a2_single_index_files/figure-html/diagresidmaps-1.png" class="r-plt" alt="" width="700"></p>
<p>For reproducibility, the diagnostics list also includes a time
stamp</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagnostics</span><span class="op">$</span><span class="va">date</span></span>
<span><span class="co">#&gt; [1] "2026-01-23"</span></span></code></pre></div>
<p>and the session info with</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagnostics</span><span class="op">$</span><span class="va">session_info</span></span>
<span><span class="co">#&gt; R version 4.5.2 (2025-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] tibble_3.3.1 sdmTMB_0.8.1 purrr_1.2.1  indexwc_0.8  dplyr_1.1.4 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] gtable_0.3.6       raster_3.6-32      TMB_1.9.19         xfun_0.56         </span></span>
<span><span class="co">#&gt;  [5] bslib_0.9.0        ggplot2_4.0.1      htmlwidgets_1.6.4  lattice_0.22-7    </span></span>
<span><span class="co">#&gt;  [9] vctrs_0.7.1        tools_4.5.2        Rdpack_2.6.5       generics_0.1.4    </span></span>
<span><span class="co">#&gt; [13] proxy_0.4-29       pkgconfig_2.0.3    Matrix_1.7-4       KernSmooth_2.23-26</span></span>
<span><span class="co">#&gt; [17] RColorBrewer_1.1-3 S7_0.2.1           desc_1.4.3         assertthat_0.2.1  </span></span>
<span><span class="co">#&gt; [21] lifecycle_1.0.5    compiler_4.5.2     farver_2.1.2       fmesher_0.6.1     </span></span>
<span><span class="co">#&gt; [25] textshaping_1.0.4  terra_1.8-93       ggforce_0.5.0      codetools_0.2-20  </span></span>
<span><span class="co">#&gt; [29] htmltools_0.5.9    class_7.3-23       sass_0.4.10        yaml_2.3.12       </span></span>
<span><span class="co">#&gt; [33] pillar_1.11.1      pkgdown_2.2.0      jquerylib_0.1.4    tidyr_1.3.2       </span></span>
<span><span class="co">#&gt; [37] MASS_7.3-65        classInt_0.4-11    cachem_1.1.0       wk_0.9.5          </span></span>
<span><span class="co">#&gt; [41] viridis_0.6.5      reformulas_0.4.3.1 nlme_3.1-168       inlabru_2.13.0    </span></span>
<span><span class="co">#&gt; [45] tidyselect_1.2.1   digest_0.6.39      sf_1.0-24          labeling_0.4.3    </span></span>
<span><span class="co">#&gt; [49] splines_4.5.2      polyclip_1.10-7    rprojroot_2.1.1    fastmap_1.2.0     </span></span>
<span><span class="co">#&gt; [53] grid_4.5.2         here_1.0.2         cli_3.6.5          magrittr_2.0.4    </span></span>
<span><span class="co">#&gt; [57] broom_1.0.11       e1071_1.7-17       withr_3.0.2        scales_1.4.0      </span></span>
<span><span class="co">#&gt; [61] backports_1.5.0    sp_2.2-0           rmarkdown_2.30     otel_0.2.0        </span></span>
<span><span class="co">#&gt; [65] gridExtra_2.3      ragg_1.5.0         evaluate_1.0.5     knitr_1.51        </span></span>
<span><span class="co">#&gt; [69] rbibutils_2.4.1    viridisLite_0.4.2  s2_1.1.9           mgcv_1.9-3        </span></span>
<span><span class="co">#&gt; [73] rlang_1.1.7        Rcpp_1.1.1         glue_1.8.0         DBI_1.2.3         </span></span>
<span><span class="co">#&gt; [77] tweenr_2.0.3       jsonlite_2.0.0     R6_2.6.1           systemfonts_1.3.1 </span></span>
<span><span class="co">#&gt; [81] fs_1.6.6           units_1.0-0</span></span></code></pre></div>
<p>The original data is returned (with residual values added) as</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagnostics</span><span class="op">$</span><span class="va">data_with_residuals</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,521 × 21</span></span></span>
<span><span class="co">#&gt;     year fyear survey_name common_name         catch_numbers catch_weight effort</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">2</span>003 2003  WCGBTS      yellowtail rockfish             0        0     0.017<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">2</span>003 2003  WCGBTS      yellowtail rockfish           703        1.13  0.019<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">2</span>003 2003  WCGBTS      yellowtail rockfish             0        0     0.022<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">2</span>003 2003  WCGBTS      yellowtail rockfish             0        0     0.020<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>003 2003  WCGBTS      yellowtail rockfish             0        0     0.018<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>003 2003  WCGBTS      yellowtail rockfish           186        0.248 0.020<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>003 2003  WCGBTS      yellowtail rockfish             0        0     0.021<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>003 2003  WCGBTS      yellowtail rockfish             0        0     0.022<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>003 2003  WCGBTS      yellowtail rockfish             0        0     0.017<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>003 2003  WCGBTS      yellowtail rockfish             0        0     0.020<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4,511 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 14 more variables: pass_scaled &lt;dbl&gt;, vessel_year &lt;fct&gt;, longitude &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   latitude &lt;dbl&gt;, depth &lt;dbl&gt;, depth_scaled &lt;dbl[,1]&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   depth_scaled_squared &lt;dbl[,1]&gt;, x &lt;dbl&gt;, y &lt;dbl&gt;, split_mendocino &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   residuals &lt;dbl&gt;, residuals2 &lt;dbl&gt;, X &lt;dbl&gt;, Y &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Finally, predictions on the survey grid (or other data passed in) are
stored in a dataframe</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagnostics</span><span class="op">$</span><span class="va">predictions</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 912,560 × 60</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Rowwise: </span></span></span>
<span><span class="co">#&gt;    OBJECTID Point_id Northin_m Easting_m latitude longitude Ngdc_m  Hard Mixed</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>        1    <span style="text-decoration: underline;">43</span>127      <span style="text-decoration: underline;">4</span>000    <span style="text-decoration: underline;">581</span>500     32.0     -<span style="color: #BB0000;">120.</span>  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">414</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>        2    <span style="text-decoration: underline;">43</span>128      <span style="text-decoration: underline;">4</span>000    <span style="text-decoration: underline;">583</span>500     32.0     -<span style="color: #BB0000;">120.</span>  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">692</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>        3    <span style="text-decoration: underline;">43</span>129      <span style="text-decoration: underline;">4</span>000    <span style="text-decoration: underline;">585</span>500     32.0     -<span style="color: #BB0000;">120.</span>  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">508</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>        4    <span style="text-decoration: underline;">43</span>130      <span style="text-decoration: underline;">4</span>000    <span style="text-decoration: underline;">587</span>500     32.0     -<span style="color: #BB0000;">120.</span>  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">324</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>        5    <span style="text-decoration: underline;">43</span>131      <span style="text-decoration: underline;">4</span>000    <span style="text-decoration: underline;">589</span>500     32.0     -<span style="color: #BB0000;">119.</span>  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">160</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>        6    <span style="text-decoration: underline;">43</span>132      <span style="text-decoration: underline;">4</span>000    <span style="text-decoration: underline;">591</span>500     32.0     -<span style="color: #BB0000;">119.</span>  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">205</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>        7    <span style="text-decoration: underline;">43</span>133      <span style="text-decoration: underline;">4</span>000    <span style="text-decoration: underline;">619</span>500     32.0     -<span style="color: #BB0000;">119.</span>  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">600</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>        8    <span style="text-decoration: underline;">43</span>134      <span style="text-decoration: underline;">4</span>000    <span style="text-decoration: underline;">621</span>500     32.0     -<span style="color: #BB0000;">119.</span>  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">573</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>        9    <span style="text-decoration: underline;">43</span>135      <span style="text-decoration: underline;">4</span>000    <span style="text-decoration: underline;">623</span>500     32.0     -<span style="color: #BB0000;">119.</span>  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">637</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>       10    <span style="text-decoration: underline;">43</span>136      <span style="text-decoration: underline;">4</span>000    <span style="text-decoration: underline;">625</span>500     32.0     -<span style="color: #BB0000;">119.</span>  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">568</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 912,550 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 51 more variables: Soft &lt;dbl&gt;, Slope &lt;fct&gt;, Substrate &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Confidence &lt;int&gt;, Grain &lt;dbl&gt;, Srtm_m &lt;int&gt;, Rock_dist_ &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Temp03krig &lt;dbl&gt;, Temp04krig &lt;dbl&gt;, Temp05krig &lt;dbl&gt;, Temp06krig &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Temp07krig &lt;dbl&gt;, Temp08krig &lt;dbl&gt;, Temp09krig &lt;dbl&gt;, Temp10krig &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Temp11krig &lt;dbl&gt;, Tempallyr &lt;dbl&gt;, Cowcod &lt;int&gt;, propInCCA &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   propInWCGBTS &lt;dbl&gt;, propInTriennial &lt;dbl&gt;, propInSlope98_00 &lt;dbl&gt;, …</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculating-indices">Calculating indices<a class="anchor" aria-label="anchor" href="#calculating-indices"></a>
</h3>
<p>Last, we can use the <code>calc_index_areas</code> function to
calculate indices, with associated uncertainty. We can calculate areas
for any region in the following list:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/available_areas.html">available_areas</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Coastwide"                 "WA"                       </span></span>
<span><span class="co">#&gt;  [3] "OR"                        "CA"                       </span></span>
<span><span class="co">#&gt;  [5] "North of Point Conception" "South of Point Conception"</span></span>
<span><span class="co">#&gt;  [7] "North of Cape Mendocino"   "South of Cape Mendocino"  </span></span>
<span><span class="co">#&gt;  [9] "North of Monterey Bay"     "South of Monterey Bay"</span></span></code></pre></div>
<p>By default, the Coastwide index and 3 state indices are generated,
but these indices may be calculated simultaneously (note: there is not
really a speed up of doing several at the same time, because they are
done sequentially). Again we’ll leave the ‘dir’ argument set to NULL and
return everything</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_index_areas.html">calc_index_areas</a></span><span class="op">(</span></span>
<span>  data<span class="op">=</span><span class="va">fit_simple</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  fit <span class="op">=</span> <span class="va">fit_simple</span>, </span>
<span>  prediction_grid<span class="op">=</span><span class="va">pred_grid</span>,</span>
<span>  boundaries <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Coastwide"</span><span class="op">)</span>,</span>
<span>  dir <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>The indices may be visualized by extracting the time series plot</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">index</span><span class="op">$</span><span class="va">plot_indices</span></span></code></pre></div>
<p><img src="a2_single_index_files/figure-html/diagindexplot-1.png" class="r-plt" alt="" width="700"></p>
<p>or more custom code could be used to make a plot based off of</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">index</span><span class="op">$</span><span class="va">indices</span></span>
<span><span class="co">#&gt;         area year        est         lwr        upr   log_est        se</span></span>
<span><span class="co">#&gt; 1  Coastwide 2003  45776.204  23080.8171  90787.983 10.731520 0.3493751</span></span>
<span><span class="co">#&gt; 2  Coastwide 2004  33066.659  14444.4891  75696.961 10.406281 0.4225652</span></span>
<span><span class="co">#&gt; 3  Coastwide 2005  32881.305  18155.7586  59550.265 10.400660 0.3030242</span></span>
<span><span class="co">#&gt; 4  Coastwide 2006  13025.652   6409.1224  26472.832  9.474676 0.3618425</span></span>
<span><span class="co">#&gt; 5  Coastwide 2007  35819.918  19968.1294  64255.721 10.486259 0.2981517</span></span>
<span><span class="co">#&gt; 6  Coastwide 2008  17604.221   8779.0919  35300.757  9.775894 0.3549890</span></span>
<span><span class="co">#&gt; 7  Coastwide 2009  10652.964   5495.7664  20649.649  9.273593 0.3376900</span></span>
<span><span class="co">#&gt; 8  Coastwide 2010  45785.712  25636.7911  81770.429 10.731727 0.2958950</span></span>
<span><span class="co">#&gt; 9  Coastwide 2011  43052.639  24379.2254  76029.066 10.670179 0.2901544</span></span>
<span><span class="co">#&gt; 10 Coastwide 2012  64019.558  34820.4069 117704.077 11.066944 0.3107123</span></span>
<span><span class="co">#&gt; 11 Coastwide 2013  47017.098  19626.4773 112633.943 10.758267 0.4457387</span></span>
<span><span class="co">#&gt; 12 Coastwide 2014  80231.052  46372.3624 138811.596 11.292666 0.2797026</span></span>
<span><span class="co">#&gt; 13 Coastwide 2015  34300.859  20654.4247  56963.529 10.442926 0.2588011</span></span>
<span><span class="co">#&gt; 14 Coastwide 2016 141452.302  92131.7924 217175.343 11.859718 0.2187502</span></span>
<span><span class="co">#&gt; 15 Coastwide 2017  79215.503  49711.0954 126231.295 11.279927 0.2377308</span></span>
<span><span class="co">#&gt; 16 Coastwide 2018  29560.544  17966.3063  48636.919 10.294196 0.2540569</span></span>
<span><span class="co">#&gt; 17 Coastwide 2019 206798.126 103227.6334 414283.109 12.239498 0.3544996</span></span>
<span><span class="co">#&gt; 18 Coastwide 2021  13823.626   6943.0633  27522.814  9.534134 0.3513514</span></span>
<span><span class="co">#&gt; 19 Coastwide 2022  29214.635  15041.7082  56741.886 10.282425 0.3387016</span></span>
<span><span class="co">#&gt; 20 Coastwide 2023  20043.525  12352.7782  32522.472  9.905661 0.2469561</span></span>
<span><span class="co">#&gt; 21        WA 2003  14344.548   7232.6639  28449.555  9.571125 0.3493751</span></span>
<span><span class="co">#&gt; 22        WA 2004  10361.853   4526.3621  23720.594  9.245886 0.4225652</span></span>
<span><span class="co">#&gt; 23        WA 2005  10303.770   5689.3350  18660.824  9.240265 0.3030242</span></span>
<span><span class="co">#&gt; 24        WA 2006   4081.752   2008.3790   8295.594  8.314282 0.3618425</span></span>
<span><span class="co">#&gt; 25        WA 2007  11224.621   6257.2641  20135.337  9.325865 0.2981517</span></span>
<span><span class="co">#&gt; 26        WA 2008   5516.504   2751.0387  11061.936  8.615500 0.3549890</span></span>
<span><span class="co">#&gt; 27        WA 2009   3338.240   1722.1674   6470.827  8.113199 0.3376900</span></span>
<span><span class="co">#&gt; 28        WA 2010  14347.528   8033.6105  25623.791  9.571333 0.2958950</span></span>
<span><span class="co">#&gt; 29        WA 2011  13491.085   7639.5365  23824.663  9.509784 0.2901544</span></span>
<span><span class="co">#&gt; 30        WA 2012  20061.333  10911.4119  36884.051  9.906549 0.3107123</span></span>
<span><span class="co">#&gt; 31        WA 2013  14733.398   6150.2032  35295.261  9.597872 0.4457387</span></span>
<span><span class="co">#&gt; 32        WA 2014  25141.408  14531.3622  43498.357 10.132271 0.2797026</span></span>
<span><span class="co">#&gt; 33        WA 2015  10748.605   6472.3234  17850.237  9.282531 0.2588011</span></span>
<span><span class="co">#&gt; 34        WA 2016  44325.855  28870.6544  68054.622 10.699323 0.2187502</span></span>
<span><span class="co">#&gt; 35        WA 2017  24823.173  15577.5961  39556.162 10.119533 0.2377308</span></span>
<span><span class="co">#&gt; 36        WA 2018   9263.168   5629.9677  15240.990  9.133801 0.2540569</span></span>
<span><span class="co">#&gt; 37        WA 2019  64802.790  32347.6755 129820.816 11.079104 0.3544996</span></span>
<span><span class="co">#&gt; 38        WA 2021   4331.807   2175.6961   8624.619  8.373740 0.3513514</span></span>
<span><span class="co">#&gt; 39        WA 2022   9154.773   4713.5082  17780.783  9.122031 0.3387016</span></span>
<span><span class="co">#&gt; 40        WA 2023   6280.890   3870.8982  10191.325  8.745267 0.2469561</span></span>
<span><span class="co">#&gt; 41        OR 2003  23187.711  11691.4744  45988.206 10.051378 0.3493751</span></span>
<span><span class="co">#&gt; 42        OR 2004  16749.753   7316.7849  38343.923  9.726139 0.4225652</span></span>
<span><span class="co">#&gt; 43        OR 2005  16655.863   9196.7102  30164.894  9.720518 0.3030242</span></span>
<span><span class="co">#&gt; 44        OR 2006   6598.080   3246.5094  13409.683  8.794534 0.3618425</span></span>
<span><span class="co">#&gt; 45        OR 2007  18144.403  10114.7577  32548.420  9.806117 0.2981517</span></span>
<span><span class="co">#&gt; 46        OR 2008   8917.331   4447.0058  17881.425  9.095752 0.3549890</span></span>
<span><span class="co">#&gt; 47        OR 2009   5396.207   2783.8534  10459.978  8.593452 0.3376900</span></span>
<span><span class="co">#&gt; 48        OR 2010  23192.527  12986.1904  41420.409 10.051585 0.2958950</span></span>
<span><span class="co">#&gt; 49        OR 2011  21808.103  12349.1767  38512.149  9.990037 0.2901544</span></span>
<span><span class="co">#&gt; 50        OR 2012  32428.792  17638.1058  59622.421 10.386802 0.3107123</span></span>
<span><span class="co">#&gt; 51        OR 2013  23816.280   9941.6956  57054.170 10.078125 0.4457387</span></span>
<span><span class="co">#&gt; 52        OR 2014  40640.645  23489.6921  70314.331 10.612524 0.2797026</span></span>
<span><span class="co">#&gt; 53        OR 2015  17374.931  10462.3972  28854.595  9.762784 0.2588011</span></span>
<span><span class="co">#&gt; 54        OR 2016  71651.968  46668.9063 110009.102 11.179576 0.2187502</span></span>
<span><span class="co">#&gt; 55        OR 2017  40126.223  25180.9109  63941.841 10.599785 0.2377308</span></span>
<span><span class="co">#&gt; 56        OR 2018  14973.748   9100.7441  24636.792  9.614054 0.2540569</span></span>
<span><span class="co">#&gt; 57        OR 2019 104752.573  52289.4499 209853.071 11.559356 0.3544996</span></span>
<span><span class="co">#&gt; 58        OR 2021   7002.290   3516.9746  13941.546  8.853992 0.3513514</span></span>
<span><span class="co">#&gt; 59        OR 2022  14798.530   7619.3033  28742.323  9.602283 0.3387016</span></span>
<span><span class="co">#&gt; 60        OR 2023  10152.949   6257.2391  16474.098  9.225519 0.2469561</span></span>
<span><span class="co">#&gt; 61        CA 2003   8243.944   4156.6788  16350.222  9.017234 0.3493751</span></span>
<span><span class="co">#&gt; 62        CA 2004   5955.053   2601.3421  13632.444  8.691995 0.4225652</span></span>
<span><span class="co">#&gt; 63        CA 2005   5921.672   3269.7134  10724.548  8.686374 0.3030242</span></span>
<span><span class="co">#&gt; 64        CA 2006   2345.820   1154.2340   4767.555  7.760390 0.3618425</span></span>
<span><span class="co">#&gt; 65        CA 2007   6450.894   3596.1075  11571.964  8.771974 0.2981517</span></span>
<span><span class="co">#&gt; 66        CA 2008   3170.386   1581.0474   6357.397  8.061609 0.3549890</span></span>
<span><span class="co">#&gt; 67        CA 2009   1918.517    989.7455   3718.844  7.559308 0.3376900</span></span>
<span><span class="co">#&gt; 68        CA 2010   8245.657   4616.9902  14726.229  9.017442 0.2958950</span></span>
<span><span class="co">#&gt; 69        CA 2011   7753.451   4390.5122  13692.254  8.955893 0.2901544</span></span>
<span><span class="co">#&gt; 70        CA 2012  11529.433   6270.8892  21197.605  9.352658 0.3107123</span></span>
<span><span class="co">#&gt; 71        CA 2013   8467.420   3534.5786  20284.512  9.043981 0.4457387</span></span>
<span><span class="co">#&gt; 72        CA 2014  14448.999   8351.3081  24998.908  9.578380 0.2797026</span></span>
<span><span class="co">#&gt; 73        CA 2015   6177.323   3719.7041  10258.696  8.728640 0.2588011</span></span>
<span><span class="co">#&gt; 74        CA 2016  25474.479  16592.2318  39111.620 10.145432 0.2187502</span></span>
<span><span class="co">#&gt; 75        CA 2017  14266.107   8952.5884  22733.292  9.565642 0.2377308</span></span>
<span><span class="co">#&gt; 76        CA 2018   5323.628   3235.5945   8759.138  8.579910 0.2540569</span></span>
<span><span class="co">#&gt; 77        CA 2019  37242.762  18590.5080  74609.222 10.525213 0.3544996</span></span>
<span><span class="co">#&gt; 78        CA 2021   2489.529   1250.3926   4956.648  7.819849 0.3513514</span></span>
<span><span class="co">#&gt; 79        CA 2022   5261.333   2708.8967  10218.780  8.568140 0.3387016</span></span>
<span><span class="co">#&gt; 80        CA 2023   3609.686   2224.6410   5857.049  8.191376 0.2469561</span></span>
<span><span class="co">#&gt;    se_natural  type</span></span>
<span><span class="co">#&gt; 1   45776.204 index</span></span>
<span><span class="co">#&gt; 2   33066.659 index</span></span>
<span><span class="co">#&gt; 3   32881.305 index</span></span>
<span><span class="co">#&gt; 4   13025.652 index</span></span>
<span><span class="co">#&gt; 5   35819.918 index</span></span>
<span><span class="co">#&gt; 6   17604.221 index</span></span>
<span><span class="co">#&gt; 7   10652.964 index</span></span>
<span><span class="co">#&gt; 8   45785.712 index</span></span>
<span><span class="co">#&gt; 9   43052.639 index</span></span>
<span><span class="co">#&gt; 10  64019.558 index</span></span>
<span><span class="co">#&gt; 11  47017.098 index</span></span>
<span><span class="co">#&gt; 12  80231.052 index</span></span>
<span><span class="co">#&gt; 13  34300.859 index</span></span>
<span><span class="co">#&gt; 14 141452.302 index</span></span>
<span><span class="co">#&gt; 15  79215.503 index</span></span>
<span><span class="co">#&gt; 16  29560.544 index</span></span>
<span><span class="co">#&gt; 17 206798.126 index</span></span>
<span><span class="co">#&gt; 18  13823.626 index</span></span>
<span><span class="co">#&gt; 19  29214.635 index</span></span>
<span><span class="co">#&gt; 20  20043.525 index</span></span>
<span><span class="co">#&gt; 21  14344.548 index</span></span>
<span><span class="co">#&gt; 22  10361.853 index</span></span>
<span><span class="co">#&gt; 23  10303.770 index</span></span>
<span><span class="co">#&gt; 24   4081.752 index</span></span>
<span><span class="co">#&gt; 25  11224.621 index</span></span>
<span><span class="co">#&gt; 26   5516.504 index</span></span>
<span><span class="co">#&gt; 27   3338.240 index</span></span>
<span><span class="co">#&gt; 28  14347.528 index</span></span>
<span><span class="co">#&gt; 29  13491.085 index</span></span>
<span><span class="co">#&gt; 30  20061.333 index</span></span>
<span><span class="co">#&gt; 31  14733.398 index</span></span>
<span><span class="co">#&gt; 32  25141.408 index</span></span>
<span><span class="co">#&gt; 33  10748.605 index</span></span>
<span><span class="co">#&gt; 34  44325.855 index</span></span>
<span><span class="co">#&gt; 35  24823.173 index</span></span>
<span><span class="co">#&gt; 36   9263.168 index</span></span>
<span><span class="co">#&gt; 37  64802.790 index</span></span>
<span><span class="co">#&gt; 38   4331.807 index</span></span>
<span><span class="co">#&gt; 39   9154.773 index</span></span>
<span><span class="co">#&gt; 40   6280.890 index</span></span>
<span><span class="co">#&gt; 41  23187.711 index</span></span>
<span><span class="co">#&gt; 42  16749.753 index</span></span>
<span><span class="co">#&gt; 43  16655.863 index</span></span>
<span><span class="co">#&gt; 44   6598.080 index</span></span>
<span><span class="co">#&gt; 45  18144.403 index</span></span>
<span><span class="co">#&gt; 46   8917.331 index</span></span>
<span><span class="co">#&gt; 47   5396.207 index</span></span>
<span><span class="co">#&gt; 48  23192.527 index</span></span>
<span><span class="co">#&gt; 49  21808.103 index</span></span>
<span><span class="co">#&gt; 50  32428.792 index</span></span>
<span><span class="co">#&gt; 51  23816.280 index</span></span>
<span><span class="co">#&gt; 52  40640.645 index</span></span>
<span><span class="co">#&gt; 53  17374.931 index</span></span>
<span><span class="co">#&gt; 54  71651.968 index</span></span>
<span><span class="co">#&gt; 55  40126.223 index</span></span>
<span><span class="co">#&gt; 56  14973.748 index</span></span>
<span><span class="co">#&gt; 57 104752.573 index</span></span>
<span><span class="co">#&gt; 58   7002.290 index</span></span>
<span><span class="co">#&gt; 59  14798.530 index</span></span>
<span><span class="co">#&gt; 60  10152.949 index</span></span>
<span><span class="co">#&gt; 61   8243.944 index</span></span>
<span><span class="co">#&gt; 62   5955.053 index</span></span>
<span><span class="co">#&gt; 63   5921.672 index</span></span>
<span><span class="co">#&gt; 64   2345.820 index</span></span>
<span><span class="co">#&gt; 65   6450.894 index</span></span>
<span><span class="co">#&gt; 66   3170.386 index</span></span>
<span><span class="co">#&gt; 67   1918.517 index</span></span>
<span><span class="co">#&gt; 68   8245.657 index</span></span>
<span><span class="co">#&gt; 69   7753.451 index</span></span>
<span><span class="co">#&gt; 70  11529.433 index</span></span>
<span><span class="co">#&gt; 71   8467.420 index</span></span>
<span><span class="co">#&gt; 72  14448.999 index</span></span>
<span><span class="co">#&gt; 73   6177.323 index</span></span>
<span><span class="co">#&gt; 74  25474.479 index</span></span>
<span><span class="co">#&gt; 75  14266.107 index</span></span>
<span><span class="co">#&gt; 76   5323.628 index</span></span>
<span><span class="co">#&gt; 77  37242.762 index</span></span>
<span><span class="co">#&gt; 78   2489.529 index</span></span>
<span><span class="co">#&gt; 79   5261.333 index</span></span>
<span><span class="co">#&gt; 80   3609.686 index</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="saving-output">Saving output<a class="anchor" aria-label="anchor" href="#saving-output"></a>
</h2>
<p>As demonstrated above, there are a lot of plots and diagnostics that
can be inspected, and in many cases we might want to save everything.
The <code>save_index_outputs</code> function in <code>indexwc</code>
will write everything locally (for the directory structure, see
<code><a href="../reference/save_index_outputs.html">?save_index_outputs</a></code>)</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/save_index_outputs.html">save_index_outputs</a></span><span class="op">(</span></span>
<span>  fit <span class="op">=</span> <span class="va">fit_simple</span>,</span>
<span>  diagnostics <span class="op">=</span> <span class="va">diagnostics</span>,</span>
<span>  indices <span class="op">=</span> <span class="va">index</span>,</span>
<span>  dir_main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/yellowtail_example"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kelli F. Johnson, Sean C. Anderson, Chantel R. Wetzel, Eric J. Ward, Ian G. Taylor.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
